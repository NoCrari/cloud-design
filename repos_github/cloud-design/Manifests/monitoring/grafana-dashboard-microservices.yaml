apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-microservices
  namespace: monitoring
data:
  microservices-overview.json: |
    {
      "title": "Microservices Overview",
      "tags": ["microservices"],
      "timezone": "browser",
      "schemaVersion": 36,
      "version": 1,
      "refresh": "30s",
      "panels": [
        {
          "type": "stat",
          "title": "Scraped Targets (microservices)",
          "gridPos": {"h": 6, "w": 8, "x": 0, "y": 0},
          "targets": [
            {"expr": "count(up{namespace=\"microservices\"}==1) or on() vector(0)"}
          ]
        },
        {
          "type": "graph",
          "title": "CPU secs/s by pod (microservices)",
          "gridPos": {"h": 8, "w": 12, "x": 8, "y": 0},
          "targets": [
            {"expr": "sum by (pod) (rate(process_cpu_seconds_total{namespace=\"microservices\"}[5m])) or sum by (pod) (rate(process_cpu_seconds_total[5m]))"}
          ]
        },
        {
          "type": "graph",
          "title": "RSS Memory by pod (microservices)",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
          "targets": [
            {"expr": "sum by (pod) (process_resident_memory_bytes{namespace=\"microservices\"}) or sum by (pod) (process_resident_memory_bytes)"}
          ]
        },
        {
          "type": "graph",
          "title": "Samples scraped by job",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
          "targets": [
            {"expr": "sum by (job) (scrape_samples_post_metric_relabeling)"}
          ]
        }
      ]
    }

